@page "/register"
@{

}

<style>
    .error-area {
        color: red;
    }

    .daterangepicker .drp-calendar {
        max-width: 100% !important;
    }
</style>
<!--banner ends-->
<div class="recipes-home-body inner-page">
    <div class="container">
        <div class="row">
            <div class="col-md-8 col-lg-9">
                <div class="recipe-set submit-recipe-set">
                    <h2>Đăng ký</h2>
                    <div class="submit-recipe-form">
                        <form action="#" method="post" id="register-form">
                            <label for="title">Tên đăng nhập *</label>
                            <input type="text" name="usernameVM" required autocomplete="off" readonly
                                   onfocus="this.removeAttribute('readonly');" />
                            <label for="title">Họ *</label>
                            <input type="text" name="lastName" required />
                            <br />
                            <label for="title">Tên *</label>
                            <input type="text" name="firstName" required />
                            <label for="title">Email*</label>
                            <input type="email" name="email" placeholder="Ví dụ: ten.ho@@gmail.com" required autocomplete="off" readonly
                                   onfocus="this.removeAttribute('readonly');" />
                            <label for="title">Mật khẩu*</label>
                            <input type="password" name="password" placeholder="Ví dụ: abC@@1234" required autocomplete="off" readonly
                                   onfocus="this.removeAttribute('readonly');" />
                            <label for="title">Xác nhận mật khẩu*</label>
                            <input type="password" name="confirmPassword" placeholder="Ví dụ: abC@@1234" required autocomplete="off" readonly
                                   onfocus="this.removeAttribute('readonly');" />
                            <label for="birthdateStr">Ngày sinh</label>
                            <input type="text" name="birthdateStr" id="birthdateStr" required />
                            <input type="hidden" name="birthdate" id="birthdate" />
                            <label for="gender">Giới tính</label>
                            <select name="gender" id="gender" class="advance-selectable">
                                <option value="0" selected="selected">Nam</option>
                                <option value="1">Nữ</option>
                            </select>
                            <label for="txtAddress">Địa chỉ</label>
                            <input type="text" name="address" id="txtAddress" required />
                            <input type="hidden" name="description" />
                            <input type="hidden" name="avatarUrl" />
                            <div class="row error-area">

                            </div>
                            <div class="text-center">
                                <button type="submit" class="recipe-submit-btn">Đăng ký</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <div class="col-md-4 col-lg-3">
                <aside>
                    <div class="side-bar">
                        <!--recipes search widget-->
                        <div class="widget recipe-search">
                            <div class="search-bar-widget">
                                <form action="#">
                                    <div class="search-field">
                                        <input type="search" name="search" placeholder="Search" />
                                        <button type="submit"><i class="fa fa-search"></i></button>
                                    </div>
                                </form>
                            </div>

                            <div class="category-list">
                                <!--<div class="list-inner">-->
                                <ul id="list-category-item-Registerpage"></ul>
                                <!--</div>-->
                            </div>
                        </div>
                        <!--recipes search widget ends-->
                        <!--popular recipes widget-->
                        <div class="widget latest-news-widget">
                            <h2>popular recipes</h2>
                            <ul id="list-popular-recipe-widget-Registerpage"></ul>
                        </div>
                        <!--popular recipes widget ends-->
                        <div class="widget">
                            <a href="#">
                                <img src="recipepress/images/temp-images/add-side.jpg" alt="Add" />
                            </a>
                        </div>
                        <!--latest news widget-->
                        <div class="widget latest-news-widget">
                            <h2>Latest News</h2>
                            <ul id="list-latest-recipe-widget-Registerpage"></ul>
                        </div>
                        <!--latest news widget ends-->
                        <!--get social-->
                        <div class="widget widget-get-social">
                            <h2>get social</h2>
                            <ul>
                                <li class="facebook">
                                    <a href="#">
                                        <i class="fa fa-facebook"></i>
                                        <span class="count">23.5K</span>
                                        <span class="count-type">Likes</span>
                                    </a>
                                </li>
                                <li class="twitter">
                                    <a href="#">
                                        <i class="fa fa-twitter"></i>
                                        <span class="count">23.5K</span>
                                        <span class="count-type">Likes</span>
                                    </a>
                                </li>
                                <li class="google-plus">
                                    <a href="#">
                                        <i class="fa fa-google-plus"></i>
                                        <span class="count">23.5K</span>
                                        <span class="count-type">Likes</span>
                                    </a>
                                </li>

                            </ul>
                        </div>
                        <!--get social ends-->
                    </div>
                </aside>
            </div>
        </div>

    </div>
</div>

@section Scripts
    {

    <script>
        const changeHeadername = async () => {
            var someText = "Đăng ký";
            $('.main-heading h1').append(document.createTextNode(someText));
        };
        function initMap() {
            
            var input = document.getElementById('txtAddress');
            var searchBox = new google.maps.places.SearchBox(input);
        }

        (async () => {
            await changeHeadername();

        })();
        function validateRegisterForm(form) {
            var password = form['password'].value;
            var confirmPassword = form['confirmPassword'].value;
            if (!(/^(?=.*?[A-Z])(?=(.*[a-z]){1,})(?=(.*[\d]){1,})(?=(.*[\W]){1,})(?!.*\s).{8,}$/.test(password))) {
                $('.error-area').html(`
                                                <p>At least one upper case English letter</p>
                                                <p>At least one lower case English letter</p>
                                                <p>At least one digit</p>
                                                <p>At least one special character</p>
                                                <p>Minimum eight in length</p>`);
                return false;
            }
            if (password !== confirmPassword) {
                alert("Mật khẩu và xác nhận mật khẩu không trùng khớp");
                return false;
            }
            return true;
        }
        $("#register-form").on("submit", function (e) {
            e.preventDefault();
            var isValidated = validateRegisterForm(e.target);
            if (isValidated) {
                var formData = $('#register-form').serializeArray();
                var data = {};
                $.map(formData, function (n, i) {
                    data[n['name']] = n['value'];
                });

                fetch(`${BASE_API_URL}/api/account/register`, {
                    method: 'POST', // or 'PUT'
                    body: JSON.stringify(data), // data can be `string` or {object}!
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(res => res.json())
                    .then(response => {
                        if (response.success) {
                            localStorage.setItem("authorization", JSON.stringify(response.token));
                            localStorage.setItem("username", response.username);
                            window.location.href = '/';
                        }
                    })
                    .catch(error => console.error('Error:', error));
            }
            else {
                alert("Đăng ký thất bại")
            }
        });

        $(function () {
            $('#birthdateStr').daterangepicker({
                singleDatePicker: true,
                showDropdowns: true,
                minYear: 1901,
                "locale": {
                    "format": "DD/MM/YYYY",
                    "separator": " - ",
                    "applyLabel": "Xác nhận",
                    "cancelLabel": "Hủy",
                    "fromLabel": "Từ",
                    "toLabel": "Đến",
                    "customRangeLabel": "Tùy chọn",
                    "daysOfWeek": [
                        "Chủ nhật",
                        "Thứ hai",
                        "Thứ ba",
                        "Thứ tư",
                        "Thứ năm",
                        "Thứ sáu",
                        "Thứ bảy"
                    ],
                    "monthNames": [
                        "Tháng 1",
                        "Tháng 2",
                        "Tháng 3",
                        "Tháng 4",
                        "Tháng 5",
                        "Tháng 6",
                        "Tháng 7",
                        "Tháng 8",
                        "Tháng 9",
                        "Tháng 10",
                        "Tháng 11",
                        "Tháng 12"
                    ],
                    "firstDay": 1,
                }
            }, function (currentTime) {
                $("#birthdate").val((new Date(currentTime).toLocaleDateString()));
            });
        });
        const createSingleRecipeWidgetRegisterPage = (recipe) =>
            ` <li onclick="saveToLocalStorage(${recipe.id},'${recipe.recipeName}', '${recipe.imageCover}',
                                                                                                        '${new Date(recipe.createTime).getDay() + "/" + new Date(recipe.createTime).getMonth() + "/" + new Date(recipe.createTime).getFullYear()}')">
                                                        <div class="thumb">
                                                            <a href="/recipe/${recipe.id}">
                                                                <img src="${recipe.imageCover}" alt="thumbnail" />
                                                            </a>
                                                        </div>
                                                        <div class="detail">
                                                            <a href="/recipe/${recipe.id}">${recipe.recipeName}</a>
                                                            <span class="post-date">${ new Date(recipe.createTime).getDay() + "/" + new Date(recipe.createTime).getMonth() + "/" + new Date(recipe.createTime).getFullYear()}</span>
                                                        </div>
                                                    </li>

                                                   `;
        const createSingleCategoryItemRegisterPage = (item) =>
            ` <li>
                                                                <a href="#">${item.categoryItemName}</a>
                                                                <div class="list-icons">
                                                                    <svg version="1.1" class="icon-container" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                                                         width="42px" height="42px" viewBox="0 0 42 42" enable-background="new 0 0 42 42" xml:space="preserve">
<path class="icon-svg" d="M38.001,22.42v11.577c0,1.653-1.349,3-3.001,3h-8H7c-1.654,0-2.999-1.347-2.999-3V22.42C2.036,20.542,1,18.331,1,16.001
                    C1,9.937,8.177,5.003,17,5.003h8c8.823,0,16,4.934,16,10.998C41,18.331,39.964,20.541,38.001,22.42L38.001,22.42z M17,7.003
                    c-7.719,0-14,4.036-14,8.998c0,1.873,0.921,3.684,2.665,5.234C5.877,21.426,6,21.695,6,21.982v12.015c0,0.552,0.449,1.001,1,1.001
                    h20c0.552,0,1.001-0.449,1.001-1.001V21.982c0-0.287,0.12-0.558,0.334-0.748C30.079,19.683,31,17.873,31,16.001
                    C31,11.039,24.721,7.003,17,7.003L17,7.003z M26.249,7.043c4.077,1.996,6.752,5.263,6.752,8.958c0,2.33-1.036,4.54-3.001,6.419
                    v11.577c0,0.354-0.073,0.687-0.186,1.001H35c0.551,0,1-0.449,1-1.001V23h-2c-0.555,0-0.999-0.447-0.999-1
                    c0-0.552,0.444-0.999,0.999-0.999h2.578C38.157,19.5,39,17.78,39,16.001C39,11.311,33.385,7.451,26.249,7.043L26.249,7.043z
                     M20.5,16.001c-0.828,0-1.5-0.672-1.5-1.499c0-0.828,0.672-1.501,1.5-1.501s1.5,0.673,1.5,1.501
                    C22,15.329,21.328,16.001,20.5,16.001L20.5,16.001z M21,25.499C21,26.328,20.328,27,19.5,27c-0.829,0-1.5-0.672-1.5-1.501
                    C18,24.671,18.671,24,19.5,24C20.328,24,21,24.671,21,25.499L21,25.499z M11.5,21.001c-0.829,0-1.5-0.672-1.5-1.501
                    c0-0.828,0.672-1.499,1.5-1.499S13,18.672,13,19.5C13,20.329,12.329,21.001,11.5,21.001L11.5,21.001z" />

</svg>
                                                                </div>
                                                            </li>
                                                           `;

        const callLatestRecipeWidgetRegisterPageApi = async () => {
            var res = await fetch(`${BASE_API_URL}/api/recipe/read-latest`);
            var data = await res.json();
            var count = 0;
            for (var item of data) {
                count++;
                if (count >= 8) {
                    let element = createSingleRecipeWidgetRegisterPage(item);
                    $("#list-latest-recipe-widget-Registerpage").append(element);
                }
            }
        };
        const callListCategoryItemRegisterPageApi = async () => {
            var res = await fetch(`${BASE_API_URL}/api/category/read-categoryitem?categoryMainId=1`);
            var data = await res.json();
            for (var item of data) {
                for (var cateItem of item.listCategoryItem) {
                    let element = createSingleCategoryItemRegisterPage(cateItem);
                    $("#list-category-item-Registerpage").append(element);
                }
            }
        };
        const callPopularRegisterPageApi = async () => {
            var res = await fetch(`${BASE_API_URL}/api/recipe/read-popular`);
            var data = await res.json();
            var count = 0;
            for (var item of data) {
                count++;
                let element = createSingleRecipeWidgetRegisterPage(item);
                $("#list-popular-recipe-widget-Registerpage").append(element);
                if (count >= 5) {
                    break;
                }
            }
        };

        (async () => {
            await callLatestRecipeWidgetRegisterPageApi();
            await callListCategoryItemRegisterPageApi();
            await callPopularRegisterPageApi();
        })();

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBzgvkqSdA28vGw5qvqgJdPp-3_8YEBzFo&libraries=places&callback=initMap"
            async defer></script>
}