@page "/recipe/{recipe_id}"
@model SRSN.Client_View.Pages.Recipe_DetailModel
@{
    ViewData["Title"] = "Recipe_Detail";
}
<!--banner ends-->
<div class="recipes-home-body inner-page">
    <div class="container">
        <div class="row">
            <div class="col-md-8 col-lg-9">
                <div class="recipe-set ">
                    <div class="wrapper-detail-contents detail-2">
                        <div class="single-recipe-detail" id="banner-recipe">
                        </div>
                        <div class="recipe-detail-body">
                            <div id="content-recipe">
                                <!--Content-->
                            </div>
                            <br />
                            <div class="ingredients-checkbox">
                                <div class="ingredients">
                                    <h3>Nguyên liệu</h3>
                                    <button id="myBtn">Open Modal</button>
                                    <ul id="list-of-ingredients"></ul>
                                </div>
                            </div>
                            <div class="recipe-steps">
                                <h3 class="lined">Các bước thực hiện</h3>
                                <dl class="accordion clearfix" id="list-step-recipe"></dl>
                            </div>
                            <div class="separator-post"></div>
                            <div class="tags-icons">
                                <div class="row">
                                    <div class="col-sm-7">
                                        <div class="details-tags">
                                            <ul>
                                                <li><a href="#">garlic</a></li>
                                                <li><a href="#">pizza</a></li>
                                                <li><a href="#">potato</a></li>
                                                <li><a href="#">roasted</a></li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="col-sm-5">
                                        <div class="details-social-icons">
                                            <ul>
                                                <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                                                <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                                                <li><a href="#"><i class="fa fa-google-plus"></i></a></li>
                                                <li><a href="#"><i class="fa fa-pinterest"></i></a></li>
                                                <li><a href="#"><i class="fa fa-plus"></i></a></li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>



                        <div class="related-recipes">
                            <h3 class="lined">Related Recipes</h3>
                            <div class="boxed-recipes text-center" id="list-related-recipe">

                            </div>
                        </div>

                        <div class="recipe-comments">
                            <h3 class="lined">Comments (<span id="numOfComment"></span>)</h3>
                            <ul id="list-rating-comment"></ul>
                        </div>

                        <div class="comment-form">
                            <h3 class="lined">Leave Comment</h3>

                            <form action="#" method="post">
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="col-md-3 rating-title">Đánh giá công thức</div>
                                        <div class="col-md-8">
                                            <fieldset class="rating-recipe">
                                                <input type="radio" id="star5" name="rating" value="5" /><label class="full" for="star5" title="Awesome - 5 stars"></label>
                                                <input type="radio" id="star4half" name="rating" value="4 and a half" /><label class="half" for="star4half" title="Pretty good - 4.5 stars"></label>
                                                <input type="radio" id="star4" name="rating" value="4" /><label class="full" for="star4" title="Pretty good - 4 stars"></label>
                                                <input type="radio" id="star3half" name="rating" value="3 and a half" /><label class="half" for="star3half" title="Meh - 3.5 stars"></label>
                                                <input type="radio" id="star3" name="rating" value="3" /><label class="full" for="star3" title="Meh - 3 stars"></label>
                                                <input type="radio" id="star2half" name="rating" value="2 and a half" /><label class="half" for="star2half" title="Kinda bad - 2.5 stars"></label>
                                                <input type="radio" id="star2" name="rating" value="2" /><label class="full" for="star2" title="Kinda bad - 2 stars"></label>
                                                <input type="radio" id="star1half" name="rating" value="1 and a half" /><label class="half" for="star1half" title="Meh - 1.5 stars"></label>
                                                <input type="radio" id="star1" name="rating" value="1" /><label class="full" for="star1" title="Sucks big time - 1 star"></label>
                                                <input type="radio" id="starhalf" name="rating" value="half" /><label class="half" for="starhalf" title="Sucks big time - 0.5 stars"></label>
                                            </fieldset>
                                        </div>
                                    </div>
                                    <div class="col-md-12">
                                        <textarea name="comment" id="comment"
                                                  placeholder="Bình luận:
* Mẹo: Nội dung đánh giá phải mang tính chất khách quan, từ chia sẻ đánh giá của bạn sẽ giúp rất nhiều cho người dùng có quyết định lựa chọn đúng đắn."></textarea>
                                    </div>
                                </div>

                                <button class="submit-comment">Đánh giá</button>
                            </form>
                        </div>


                    </div>
                </div>
            </div>
            <div class="col-md-4 col-lg-3">
                <aside>
                    <div class="side-bar">
                        <!--recipes search widget-->
                        <div class="widget recipe-search">

                            <div class="category-list">
                                <!--<div class="list-inner">-->
                                <ul id="list-category-item-recipe-detail"></ul>
                                <!--</div>-->
                            </div>
                        </div>
                        <!---recipes search widget ends-->
                        <!--popular recipes widget-->
                        <div class="widget latest-news-widget">
                            <h2>popular recipes</h2>
                            <ul id="popular-recipes-detail"></ul>
                        </div>
                        <!--popular recipes widget ends-->
                        <div class="widget">
                            <a href="#">
                                <img src="/recipepress/images/temp-images/add-side.jpg" alt="Add" />
                            </a>
                        </div>
                        <!--latest news widget-->
                        <div class="widget latest-news-widget">
                            <h2>Latest Recipes</h2>
                            <ul id="latest-recipe-detail"></ul>
                        </div>
                        <!--latest news widget ends-->
                        <!--get social-->
                        <div class="widget widget-get-social">
                            <h2>get social</h2>
                            <ul>
                                <li class="facebook">
                                    <a href="#">
                                        <i class="fa fa-facebook"></i>
                                        <span class="count">23.5K</span>
                                        <span class="count-type">Likes</span>
                                    </a>
                                </li>
                                <li class="twitter">
                                    <a href="#">
                                        <i class="fa fa-twitter"></i>
                                        <span class="count">23.5K</span>
                                        <span class="count-type">Likes</span>
                                    </a>
                                </li>
                                <li class="google-plus">
                                    <a href="#">
                                        <i class="fa fa-google-plus"></i>
                                        <span class="count">23.5K</span>
                                        <span class="count-type">Likes</span>
                                    </a>
                                </li>

                            </ul>
                        </div>

                        <!--get social ends-->
                    </div>
                </aside>

            </div>
        </div>

    </div>
    <!-- The Modal -->
    <div id="myModal" class="modal">
        <!-- Modal content -->
        <div class="row modal-content">
            <div class="col-md-12 modal-header">
                <span class="close">&times;</span>
            </div>
            <div class="col-md-12 modal-body">
                <div class="col-md-5">
                    <div class="modal-component-1" id="modal-products">
                        <style>
                            .modal-list-product-item{

                            }
                            .modal-product-item {
                                cursor: pointer;
                            }
                            .modal-product-item:hover {
                                background-color: dodgerblue;
                            }
                        </style>
                        <ul class="modal-list-product-item">
                           
                        </ul>
                    </div>
                </div>
                <div class="col-md-7">
                    <div class="modal-component-2">
                        <div id="map"></div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

@section Scripts {
    <script src="~/js/recipeDetail.js"></script>

    <script type="text/javascript">
        // fetch and render element to html
        const changeHeadername = async () => {
            var someText = "Công thức chi tiết";
            $('.main-heading h1').append(document.createTextNode(someText));
        };
        var map, infoWindow;
        function initMap() {
            //// The location of Uluru
            //var uluru = { lat: -25.344, lng: 131.036 };
            //// The map, centered at Uluru
            //var map = new google.maps.Map(
            //    document.getElementById('map'), { zoom: 4, center: uluru });
            //// The marker, positioned at Uluru
            //var marker = new google.maps.Marker({ position: uluru, map: map });

            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 10.762622, lng: 106.660172 },
                zoom: 15
            });
            infoWindow = new google.maps.InfoWindow;

            // Try HTML5 geolocation.
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };

                    infoWindow.setPosition(pos);
                    infoWindow.setContent('Vị trí của bạn');
                    infoWindow.open(map);
                    map.setCenter(pos);
                }, function () {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }
        };
        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ?
                'Lỗi: Dịch vụ định vị xảy ra lỗi' :
                'Lỗi: Trình duyệt của bạn không hỗ trợ định vị');
            infoWindow.open(map);
        };
        (async () => {
            // Init elements
            await changeHeadername();
            await callRecipeDetailApi(@(RouteData.Values["recipe_id"]));
            await callStepOfRecipeApi(@(RouteData.Values["recipe_id"]));
            await callPopularRecipeDetailPageApi();
            await callLatestRecipeDetailApi();

            // Init products on modal list product item
            // Get ingredient names
            $('input[name=ingredient]').each(async function (index, element) {
                // Get name
                var value = element.getAttribute("value");
                if (value) {
                    var ingredientName = value.split('-')[1];
                    await callReadProductByIngredientNameApi(ingredientName);
                }
            });

            callListCategoryItemDetailPage();
            // Recipe slider variation two
            $('.slider-detail2').slick({
                autoplay: true,
                infinite: true,
                pauseOnHover: true,
                prevArrow: $('.left-arrow'),
                nextArrow: $('.right-arrow')
            });
            $('dl.accordion dt').on("click", function () {
                $(this).siblings('dt').removeClass('current');
                $(this).addClass('current').next('dd').stop(true, true).slideDown(500).siblings('dd').stop(true, true).slideUp(500);
            });
        })();
        // Get the modal
        var modal = document.getElementById('myModal');

        // Get the button that opens the modal
        var btn = document.getElementById("myBtn");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks the button, open the modal
        btn.onclick = function () {
            modal.style.display = "block";
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }


        $(".modal-product-item").on('click', function (e) {
            var current = e.currentTarget;
            var ingredient_name = current.getAttribute('data-ingredient-name');
        });



    </script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBzgvkqSdA28vGw5qvqgJdPp-3_8YEBzFo&callback=initMap">
    </script>
}